version: '3'
services:
  bitcoin-core:
    build: 0.17/alpine
    container_name: bitcoin-server
    command:
      -printtoconsole
      -regtest=1
      -deprecatedrpc=accounts
      -rpcuser="devuser"
      -rpcpassword="devpass"
      -rpcallowip=0.0.0.0/0
      -zmqpubrawblock=tcp://0.0.0.0:28332
      -zmqpubrawtx=tcp://0.0.0.0:28333
  lnd: &lnd
    build: lnd
    container_name: lnd
    environment:
      - RPCUSER
      - RPCPASS
      - NETWORK
      - DEBUG
      - ZMQBLOCKPORT
      - ZMQTXPORT
    links:
        - "bitcoin-core:blockchain"
  alice:
    <<: *lnd
    container_name: alice
    entrypoint: ["./start-lnd.sh"]
  bob:
    <<: *lnd
    container_name: bob
    entrypoint: ["./start-lnd.sh"]
